/*!***
 * gpaCalc.js - v0.13.0
 * Custom JS script module for functionalizing the Cougar Success website's GPA calculator built in using the Gravity Forms plugin. The last version of Gravity Forms this script module was tested with was 2.6.3.
 * By Daniel C. Rieck (daniel.rieck@wsu.edu). See [GitHub](https://github.com/invokeImmediately/cougarsuccess.wsu.edu/blob/main/JS/gpaCalc.js) for more info.
 * Copyright (c) 2022 Washington State University and governed by the MIT license.
 ****/
!function(t){const e=t.$,s=t.courseFldsSel,l=t.cumlGpaFldSel,i=t.cumlGpaMsgs,n=t.curCumlGpaFldSel,r=t.formSel,a=t.inpChngDelay,o=t.sbmtBtnSel,c=t.semGpaCoursesListStr,u=t.semGpaFldSel,h=t.semGpaNoCoursesMsg,d=t.totCredsFldSel;class p{constructor(t,s,i,n,r,a,o,c,u,h,d){this.formSel=t,this.sbmtBtnSel=s,this.curCumlGpaFldSel=i,this.totCredsFldSel=n,this.courseFldsSel=r,this.semGpaFldSel=a,this.semGpaNoCoursesMsg=o,this.semGpaCoursesListStr=c,this.cumlGpaFldSel=l,this.cumlGpaMsgs=[h.noInputs,h.onlyCumlGpa,h.onlyTotCreds,h.noCourses,h.onlyCourses,h.noTotCreds,h.noCumlGpa,h.allInputs],this.inpChngDelay=d,this.inpChkTimerID=null,this.cumlInpChkTimerID=null,this.clMissingInp="gpa-calc-gf__missing-inp",this.gradeLookupTbl={A:4,"A-":3.7,"B+":3.3,B:3,"B-":2.7,"C+":2.3,C:2,"C-":1.7,"D+":1.3,D:1,F:0},this.$form=e(t),1===this.$form.length&&(this.crsDtlsRowsAdded=0,this.disableSbmtBtn(),this.disableSemGpaField(),this.disableCumlGpaField(),this.restrictCurGpaEntry(),this.restrictTotCreditsEntry(),this.restrictGradeEntry(),this.restrictCreditsEntry(),this.restrictRetakeEntry(),this.setUpCalculations(),this.addMoreInitialRows())}addMoreInitialRows(){this.$crsFldsRows=this.$courseFlds.find(".gfield_list_group"),this.crsDtlsRowsAdded=this.$crsFldsRows.length-1,this.crsDtlsRowsAdded<5&&(this.addCrsDtlsRowTimerID=setTimeout(this.addCrsDtlsRow.bind(this),100))}disableCumlGpaField(){this.$cumlGpa=this.$form.find(this.cumlGpaFldSel),this.$cumlGpaLbl=this.$cumlGpa.parents(".gfield").first().find(".gfield_description"),this.$cumlGpa.on("keydown",(function(t){"A"==t.key.toUpperCase()&&t.ctrlKey||"C"==t.key.toUpperCase()&&t.ctrlKey||"ArrowDown"==t.key||"ArrowLeft"==t.key||"ArrowRight"==t.key||"ArrowUp"==t.key||"End"==t.key||"Home"==t.key||"Tab"==t.key||t.preventDefault()})),this.$cumlGpa.on("cut",(function(t){t.preventDefault()})),this.$cumlGpa.on("paste",(function(t){t.preventDefault()})),this.$cumlGpa.attr("aria-disabled","true")}disableSbmtBtn(){this.$sbmtBtn=e(this.sbmtBtnSel),this.$sbmtBtn.on("click",(function(t){t.preventDefault()})),this.$sbmtBtn.on("keydown",(function(t){t.preventDefault()})),this.$sbmtBtn.attr("tabindex","-1"),this.$sbmtBtn.prop("disabled",!0),this.$sbmtBtn.css("display","none")}disableSemGpaField(){this.$semGpa=this.$form.find(this.semGpaFldSel),this.$semGpaLbl=this.$semGpa.parents(".gfield").first().find(".gfield_description"),this.$semGpa.on("keydown",(function(t){"A"==t.key.toUpperCase()&&t.ctrlKey||"C"==t.key.toUpperCase()&&t.ctrlKey||"ArrowRight"==t.key||"ArrowLeft"==t.key||"Tab"==t.key||t.preventDefault()})),this.$semGpa.on("cut",(function(t){t.preventDefault()})),this.$semGpa.on("paste",(function(t){t.preventDefault()})),this.$semGpa.attr("aria-disabled","true")}filterCredsEntry(t){const s=new RegExp("[0-9.]","g"),l=e(t.target);let i=l.val().toString();const n=i.match(s);if(null!==n){i=n.join("");const t=/[0-9]+\.?[0-9]*/,e=i.match(t);l.val(e[0])}else l.val("")}filterCurGpaEntry(){const t=new RegExp("[0-9.]","g");let e=this.$curCumlGpa.val().toString();const s=e.match(t);if(null!==s){e=s.join("");const t=/[0-4]\.[0-9]*|[0-4]/,l=e.match(t);parseFloat(l[0])>4?this.$curCumlGpa.val("4."):this.$curCumlGpa.val(l[0])}else this.$curCumlGpa.val("")}filterGradesEntry(t){const s=new RegExp("[A-DFa-df+-]","g"),l=e(t.target);let i=l.val().toString();const n=i.match(s);if(null!==n){i=n.join("");const t=new RegExp("[Aa]-?|[Bb][+-]?|[Cc][+-]?|[Dd][+-]?|[Ff]","g"),e=i.match(t);l.val(e[0])}else l.val("")}filterRetakeEntry(t){const s=new RegExp("^No$|^Yes$","g"),l=e(t.target);let i=l.val().toString();if(null===i.match(s)){console.log("Checking garbled retake match.");let t=null,e=null,s=i.match(/[Nn]/);null!==s&&(t=s.index,console.log(`noMtchPos = ${t}`)),s=i.match(/[Yy]/),null!==s&&(e=s.index,console.log(`yesMtchPos = ${e}`)),null!==t&&null!==e&&t<e?l.val("No"):null!==t&&null!==e&&t>e||null===t&&null!==e?l.val("Yes"):null!==t&&null===e?l.val("No"):l.val("")}}filterTotCredsEntry(){const t=new RegExp("[0-9.]","g");let e=this.$totCreds.val().toString();const s=e.match(t);if(null!==s){e=s.join("");const t=/[0-9]+\.?[0-9]*/,l=e.match(t);this.$totCreds.val(l[0])}else this.$totCreds.val("")}getAllowedNavKeys(){return"ArrowDown|ArrowLeft|ArrowRight|ArrowUp|Backspace|Delete|End|Home|Tab"}restrictCurGpaEntry(){this.$curCumlGpa=this.$form.find(this.curCumlGpaFldSel);const t=new RegExp("[0-9.]|"+this.getAllowedNavKeys()),s=/[0-4]?\.[0-9]*/,l=/^[0-4]$/;this.$curCumlGpa.on("keydown",(function(i){const n=e(this),r=n[0].selectionStart,a=n[0].selectionEnd-r;(null===i.key.match(t)||0==a&&"."==i.key&&n.val().toString().match(s)||0==a&&i.key.match(/[0-9]/)&&n.val().toString().match(l)||0==a&&i.key.match(/[0-9]/)&&n.val().toString().match(s)&&r<=1||0==a&&""==n.val().toString()&&i.key.match(/[5-9]/))&&i.preventDefault()})),this.$curCumlGpa.on("input",this.filterCurGpaEntry.bind(this))}restrictCreditsEntry(){const t=new RegExp("[0-9.]|"+this.getAllowedNavKeys()),s=/[0-9]*\.[0-9.]*/;this.$form.on("keydown",this.courseFldsSel+" .gfield_list_5_cell3 input",(function(l){const i=e(this);(null===l.key.match(t)||"."==l.key&&i.val().toString().match(s))&&l.preventDefault()})),this.$form.on("input",this.courseFldsSel+" .gfield_list_5_cell3 input",this.filterCredsEntry.bind(this))}restrictGradeEntry(){const t=new RegExp("[A-DFa-df+-]|"+this.getAllowedNavKeys()),s=/[a-dfA-Df][+-]/;this.$form.on("keydown",this.courseFldsSel+" .gfield_list_5_cell2 input, "+this.courseFldsSel+" .gfield_list_5_cell5 input",(function(l){const i=e(this).val().toString();(null===l.key.match(t)||l.key.match(new RegExp("^[A-DFa-df+-]$","g"))&&i.match(s)||l.key.match(new RegExp("^[A-DFa-df]$","g"))&&i.match(new RegExp("^[A-DFa-df]$","g"))||"+"==l.key&&i.match(/[AaFf]/)||"-"==l.key&&i.match(/[Ff]/))&&l.preventDefault()})),this.$form.on("input",this.courseFldsSel+" .gfield_list_5_cell2 input, "+this.courseFldsSel+" .gfield_list_5_cell5 input",this.filterGradesEntry.bind(this))}restrictRetakeEntry(){const t=new RegExp("[NYny]|"+this.getAllowedNavKeys());this.$form.on("keydown",this.courseFldsSel+" .gfield_list_5_cell4 input",(function(s){const l=e(this);l.val().toString();null===s.key.match(t)?s.preventDefault():s.key.match(/[Yy]/)?(s.preventDefault(),l.val("Yes")):s.key.match(/[Nn]/)&&(s.preventDefault(),l.val("No"))})),this.$form.on("input",this.courseFldsSel+" .gfield_list_5_cell4 input",this.filterRetakeEntry.bind(this))}restrictTotCreditsEntry(){this.$totCreds=this.$form.find(this.totCredsFldSel);const t=new RegExp("[0-9.]|"+this.getAllowedNavKeys()),s=/[0-9]*\.[0-9.]*/;this.$totCreds.on("keydown",(function(l){const i=e(this);(null===l.key.match(t)||"."==l.key&&i.val().toString().match(s))&&l.preventDefault()})),this.$totCreds.on("input",this.filterTotCredsEntry.bind(this))}setUpCalculations(){this.$courseFlds=this.$form.find(this.courseFldsSel),this.$cumlGpa=this.$form.find(this.cumlGpaFldSel);const t=this;this.$form.on("change",this.courseFldsSel+" input",(function(s){const l=e(this);t.checkCourseDetailsRow(s,l)})),this.$form.on("input",this.courseFldsSel+" input",(function(s){const l=e(this);null!==t.inpChkTimerID&&clearTimeout(t.inpChkTimerID),t.inpChkTimerID=setTimeout(t.trigCourseDetailsInpChng.bind(t),t.inpChngDelay,l)})),this.$form.on("change",this.totCredsFldSel+", "+this.curCumlGpaFldSel+" input",(function(s){const l=e(this);t.checkCumlAcadFlds(s,l)})),this.$form.on("input",this.totCredsFldSel+", "+this.curCumlGpaFldSel+" input",(function(s){const l=e(this);null!==t.cumlInpChkTimerID&&clearTimeout(t.cumlInpChkTimerID),t.cumlInpChkTimerID=setTimeout(t.trigCumlFldsInpChng.bind(t),t.inpChngDelay,l)}))}checkCourseDetailsRow(t,e){const s=e.parent().parent();this.chkCourseNameAbs(s),this.chkRetakeStatus(s),this.recalcGpas(t)}checkCumlAcadFlds(t,e){this.recalcGpas(t)}recalcGpas(t){this.recalcSemGpa(t),this.recalcCumlGpa(t)}recalcSemGpa(t){console.log("Recalculating semester GPA."),this.semGpa=0,this.totSemCreds=0;const s=this.$courseFlds.find(".gfield_list_group"),l=this,i=[];if(s.each((function(){const t=e(this),s=t.find(".gfield_list_5_cell1 input"),n=t.find(".gfield_list_5_cell2 input"),r=n.val().toString(),a=""!==n.val()?l.gradeLookupTbl[r.toUpperCase()]:null,o=t.find(".gfield_list_5_cell3 input"),c=parseInt(o.val().toString(),10);null!==a&&c>0&&(l.semGpa+=a*c,l.totSemCreds+=c,i.push(s.val().toString()))})),this.totSemCreds>0){const t=i.reduce(((t,e,s)=>0===s?e:t+", "+e),"");this.semGpa=this.semGpa/this.totSemCreds,this.$semGpa.val(this.semGpa.toFixed(2)),this.$semGpaLbl.html(this.semGpaCoursesListStr+t)}else this.$semGpaLbl.html(this.semGpaNoCoursesMsg),this.$semGpa.val("")}recalcCumlGpa(t){console.log("Recalculating cumulative GPA."),this.futCumlGpa=0,this.futTotCreds=0;const e=""!==this.$semGpa.val().toString()?parseFloat(this.$semGpa.val().toString()):null,s=""!==this.$totCreds.val().toString()?parseFloat(this.$totCreds.val().toString()):null,l=""!==this.$curCumlGpa.val().toString()?parseFloat(this.$curCumlGpa.val().toString()):null;null!==l!==null&&null!==s&&e?(this.futTotCreds=s+this.totSemCreds,this.futCumlGpa=(l*s+this.semGpa*this.totSemCreds)/this.futTotCreds,this.$cumlGpa.val(this.futCumlGpa.toFixed(2))):this.$cumlGpa.val("");const i=(null!==e?1:0)<<2|(null!==s?1:0)<<1|(null!==l?1:0);this.$cumlGpaLbl.html(this.cumlGpaMsgs[i])}addCrsDtlsRow(){this.$courseFlds.find(".gfield_list_group").first().find(".add_list_item").trigger("click"),this.addCrsDtlsRowTimerID=setTimeout(this.addMoreInitialRows.bind(this),100)}chkCourseNameAbs(t){const e=t.find(".gfield_list_5_cell1 input"),s=e.val().toString();if(this.rowIsEmpty(t))t.find("input").removeClass(this.clMissingInp);else if(""===s){const t=/Course Name, Row ([0-9]+)/,s=e.attr("aria-label").toString().match(t);e.val(`Course ${s[1]}`)}}chkRetakeStatus(t){const e=t.find(".gfield_list_5_cell4 input"),s=t.find(".gfield_list_5_cell5 input");this.rowIsEmpty(t)||""!==e.val().toString()?"No"==e.val().toString()&&""!==s.val().toString()&&e.val("Yes"):""===s.val().toString()?e.val("No"):e.val("Yes")}markInpAsMissing(t){}rowIsEmpty(t){const s=t.find("input");let l=!0;return s.each((function(){const t=e(this);l&&(l=""===t.val())})),l}trigCourseDetailsInpChng(t){this.inpChkTimerID=null,t.trigger("change")}trigCumlFldsInpChng(t){this.cumlInpChkTimerID=null,t.trigger("change")}}e(document).on("gform_post_render",(function(){new p(r,o,n,d,s,u,h,c,l,i,a)}))}({$:jQuery,formSel:".gpa-calc-gf",sbmtBtnSel:'.gform_button[type="submit"]',courseFldsSel:".gfield.gpa-calc-gf__course-details",semGpaFldSel:".gfield.gpa-calc-gf__sem-gpa input",semGpaNoCoursesMsg:"Waiting for course details to be entered.",semGpaCoursesListStr:"This GPA is based on the details entered for courses: ",cumlGpaFldSel:".gfield.gpa-calc-gf__cuml-gpa input",cumlGpaMsgs:{noInputs:"Waiting for current cumulative GPA, total credits attempted, and this semester's course details to be entered.",onlyCumlGpa:"Waiting for total credits earned and this semester's course details to be entered.",onlyTotCreds:"Waiting for current cumulative GPA and this semester's course details to be entered.",noCourses:"Waiting for this semester's course details to be entered.",onlyCourses:"Waiting for current cumulative GPA and total credits earned to be entered.",noTotCreds:"Waiting for total credits earned to be entered",noCumlGpa:"Waiting for total credits earned to be entered",allInputs:"This anticipated future cumulative GPA is based on the current cumulative GPA, total earned credits, and the details for the courses used to calculate the anticipated GPA for this semester. "},curCumlGpaFldSel:".gfield.gpa-calc-gf__cur-cuml-gpa input",totCredsFldSel:".gfield.gpa-calc-gf__tot-creds input",inpChngDelay:500});